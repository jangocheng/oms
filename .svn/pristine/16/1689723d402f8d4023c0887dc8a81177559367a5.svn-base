<template>
    <div style="padding:10px 20px 0 20px;">
        <!-- 产品列表 -->
        <div v-if="!this.chanpinXQ">
            <div style="margin-bottom:10px;">
                <el-input placeholder="产品名称/产品状态/类别" icon="search" v-model="input2" style="width:30%;"></el-input>
                <el-button type="primary" @click="sousuo">搜索</el-button>
            </div>
            <div style="border:1px solid #838383;height:0;margin-bottom:15px;"></div>
            <div style="margin-bottom:10px;">
                <el-table :data="tableData" border style="width: 100%" stripe v-loading.body="loading">
                    <el-table-column type="index" label="序号" width="80"></el-table-column>
                    <el-table-column prop="productName" label="产品名称">
                        <template scope="props">
                            <div @click="info(props.row)">{{props.row.productName}}</div>
                        </template>
                    </el-table-column>
                    <!-- <el-table-column prop="product_group" label="组别"></el-table-column> -->
                    <el-table-column prop="productCategory" label="类别"></el-table-column>
                    <el-table-column prop="productGroup" label="型号"></el-table-column>
                    <el-table-column prop="productVersion" label="版本号"></el-table-column>
                    <el-table-column prop="productStatus" label="产品状态" sortable></el-table-column>
                    <el-table-column prop="onlineDate" label="上线时间" sortable></el-table-column>
                    <el-table-column label="宣传文档" inline-template>
                        <template>
                            <div>
                                <a :href="row.attachPath">下载</a>
                            </div>
                        </template>
                    </el-table-column>
                    <el-table-column label="操作" inline-template>
                        <template>
                                <el-button class="L-button" size="small" @click="handleEdit(row)"><img src="../imgs/edit1.png"></el-button>
                                <el-button class="L-button" size="small" @click="del(row)"><img src="../imgs/del.png"></el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
            <!-- 分页 -->
            <el-pagination
            style="text-align:right;"
            :current-page="currentPage"
            layout="total,prev, pager, next"
            :total="total"
             @current-change="currentChange">
           </el-pagination>
        </div>
        <!-- 产品详情 -->
        <div v-if="chanpinXQ">
            <div style="margin-bottom:30px;text-align:right;padding-right:10rem">
                <el-button type="primary" icon="close" @click="fanhui"></el-button>
            </div>
            <el-form :model="chanpinXQmain" label-position="center" label-width="8rem" style="width:50%;margin:0 auto;">
                <el-form-item label="产品名称">
                    <el-input v-model="chanpinXQmain.productName"></el-input>
                </el-form-item>
                <el-form-item label="类别">
                    <el-input v-model="chanpinXQmain.productCategory"></el-input>
                </el-form-item>
                <el-form-item label="版本号">
                    <el-input v-model="chanpinXQmain.productVersion"></el-input>
                </el-form-item>
                <el-form-item label="产品状态">
                    <el-input v-model="chanpinXQmain.productStatus"></el-input>
                </el-form-item>
                <el-form-item label="上线时间">
                    <el-input v-model="chanpinXQmain.createTime"></el-input>
                </el-form-item>
                <el-form-item label="型号">
                    <el-input v-model="chanpinXQmain.productGroup"></el-input>
                </el-form-item>
                <el-form-item label="网关">
                    <el-input v-model="chanpinXQmain.gateway"></el-input>
                </el-form-item>
                <el-form-item label="产品描述">
                    <el-input v-model="chanpinXQmain.productDescription"></el-input>
                </el-form-item>
                <el-form-item label="备注">
                    <el-input v-model="chanpinXQmain.remark"></el-input>
                </el-form-item>
                <el-form-item label="图片/文件">
                    <div class="ycptf">
                        <div>
                            <img :src="photos" alt="" style="width:10rem;height:10rem;">
                            <p>{{productPhotos[0].attachName}}</p>
                        </div>
                        <div>
                            <img :src="photos" alt="" style="width:10rem;height:10rem;">
                            <p>{{productFiles[0].attachName}}</p>
                        </div>
                    </div>
                </el-form-item>
            </el-form>
        </div>
        <!-- 弹窗-修改 -->
        <el-dialog title="修改" v-model="dialogs">
            <el-form :model="dialogForm" label-position="left" label-width="8rem">
                <el-form-item label="产品名称">
                    <el-input v-model="dialogForm.productName"></el-input>
                </el-form-item>
                <el-form-item label="类别">
                    <el-input v-model="dialogForm.productName"></el-input>
                </el-form-item>
                <el-form-item label="型号">
                    <el-input v-model="dialogForm.productGroup"></el-input>
                </el-form-item>
                <el-form-item label="版本号">
                    <el-input v-model="dialogForm.productVersion"></el-input>
                </el-form-item>
                <el-form-item label="产品状态称">
                    <el-input v-model="dialogForm.productStatus"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="SaveOk">确定</el-button>
                    <el-button @click="Closes">取消</el-button>
                </el-form-item>
            </el-form>
        </el-dialog>
        <el-dialog v-model="dialogss" title="修改文件/图片"  @close="close">
            <el-form>
                <el-form-item>
                    <el-upload :on-success="succ" :on-error="err" :action="action" list-type="picture" name="productPhotos" :data="sid">
                        <!-- <i class="el-icon-plus"></i> -->
                        <el-button slot="trigger" size="small" type="primary">选取图片</el-button>
                         <!-- <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button> -->
                    </el-upload>
                </el-form-item>
                <el-form-item>
                    <el-upload :on-success="succs" :on-error="err" :action="action" list-type="picture" name="productFiles" :data="sid">
                        <!-- <i class="el-icon-plus"></i> -->
                        <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
                         <!-- <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button> -->
                    </el-upload>
                </el-form-item>
            </el-form>
        </el-dialog>
    </div>
</template>
<script>
    import {getCookie} from '../js/api/cookie.js'
    import {api} from '../js/api/api.js'

    export default ({
        data () {
            return {
                sid:{
                    sid:""
                },
                downloadT:api.downloadT,
                action:api.updateUpload,
                loading:true,
                dialogs:false,
                dialogss:false,
                dialogForm:{},
                currentPage:1,
                total:6,
                pageSize:10,
                chanpinXQ:false,
                chanpinXQmain:{},
                input2:"",
                tableData:[],
                photos:"",
                files:"",
                productPhotos:[],
                productFiles:[],
                dlo:""
            }
        },
        mounted () {
            this.getProductList();
        },
        methods:{
            getProductList () {
                let param={
                    rows:this.pageSize,
                    page:this.currentPage,
                    "sort":"sid",
                	"order":"asc"
                }
                this.$http.post(api.productList,param).then((response)=>{
                     console.log(response)
                    this.total=response.body.total;
                    this.tableData=response.body.rows;
                    // this.tableData.productFiles
                    // this.dlo=((api.downloadT+"&attachPath="+row.productFiles[0].attachPath+""));

                    this.loading=!this.loading;
                })
            },
            sousuo () {
                let param={
                    rows:this.pageSize,
                    page:this.currentPage,
                    "sort":"sid",
                	"order":"asc",
                    queryStr:this.input2
                }
                this.loading=!this.loading;
                this.$http.post(api.productList,param).then((response)=>{
                    // console.log(response)
                    this.total=response.body.total;
                    this.tableData=response.body.rows;
                    this.loading=!this.loading;
                })
            },
            info (row){
                this.chanpinXQ=!this.chanpinXQ
                // console.log(row)
                this.$http.post(api.productInfo,{sid:row.sid}).then((response)=>{
                     console.log(response.body.rtData)
                    this.productPhotos=response.body.rtData.productPhotos;
                    this.productFiles=response.body.rtData.productFiles;
                    if(response.body.rtData.product.productStatus==1){
                        response.body.rtData.product.productStatus="研发"
                    }else if(response.body.rtData.product.productStatus==2){
                        response.body.rtData.product.productStatus="试用"
                    }else if(response.body.rtData.product.productStatus==3){
                        response.body.rtData.product.productStatus="上线"
                    }else if(response.body.rtData.product.productStatus==4){
                        response.body.rtData.product.productStatus="下线"
                    }
                    this.chanpinXQmain=response.body.rtData.product;
                    this.photos=encodeURI(encodeURI(api.getAttach+"&attachPath="+this.productPhotos[0].attachPath+""));
                    this.files=encodeURI(encodeURI(api.getAttach+"&attachPath="+this.productFiles[0].attachPath+""));

                })
            },
            handleEdit (row) {
                // console.log(row);
                this.dialogs=!this.dialogs;
                this.sid.sid=row.sid;
                this.$http.post(api.productInfo,{sid:row.sid}).then((response)=>{
                    // console.log(response.body.rtData)
                    this.dialogForm=response.body.rtData.product
                })
            },
            SaveOk () {
                this.$http.post(api.updatePub,this.dialogForm).then((response)=>{
                    // console.log(response)
                    this.dialogs=!this.dialogs;
                    this.$confirm("是否修改图片/文档？",{
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(()=>{
                        // this.loading=!this.loading;
                        // this.getProductList();
                        this.dialogss=!this.dialogss;
                    }).catch(()=>{
                        this.loading=!this.loading;
                         this.getProductList();
                    })
                })
            },
            err () {},
            succ (res) {
                // console.log(res);
                this.$message({
                    message:"修改图片成功",
                    type:"success"
                });
            },
            succs () {
                this.$message({
                    message:"修改文件成功",
                    type:"success"
                });
                this.dialogss=!this.dialogss;
                this.loading=!this.loading;
                this.getProductList();
            },
            close () {
                this.loading=!this.loading;
                this.getProductList();
            },
            Closes () {
                this.dialogs=!this.dialogs;
            },
            del (row) {
                this.$confirm("确定删除此项？",{
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(()=>{
                    this.loading=!this.loading;
                    this.$http.post(api.delProduct,{"sid":row.sid}).then((response)=>{
                        // console.log(response)
                        if(response.body.rtState){
                            this.$message({
                                message:response.body.rtMsg,
                                type:"success"
                            })
                            this.getProductList();
                        }

                    })
                })
            },
            fanhui () {
                this.chanpinXQ=!this.chanpinXQ
            },
            currentChange (val) {
                this.currentPage=val;
                this.loading=!this.loading;
                this.getProductList();
            }
        }
    })
</script>
<style>
    .ycptf{
        display: -webkit-box;
    }
    .ycptf>div{
        margin-right: 20px;
        text-align: center;
        width: 0%;
        -webkit-box-flex:1;
    }
</style>
