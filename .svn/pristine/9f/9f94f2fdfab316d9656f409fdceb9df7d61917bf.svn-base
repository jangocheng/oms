<template lang="html">
    <section class="L-background">
        <div class="L-width">
            <el-row :gutter="10">
                <!-- 上传照片 -->
                <el-col :span="4" :offset="2">
                    <div class="L-grid-content L-bg-purple">
                       <el-upload class="avatar-uploader" :action="imgurl" :data="this.addForm" :show-file-list="false" name="userPhoto"
                        :on-success="handleAvatarScucess" :before-upload="beforeAvatarUpload">
                           <img v-if="imageUrl" :src="imageUrl" class="avatar">
                           <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                       </el-upload>
                    </div>
                </el-col>
                <el-col :span="5">
                    <div class="L-grid-content L-bg-purple">
                        <el-form>
                              <el-form-item class="L-form-item" label="姓名">
                              </el-form-item>
                              <el-form-item class="L-form-item" label="电话">
                              </el-form-item>
                              <el-form-item class="L-form-item" label="账号">
                              </el-form-item>
                              <el-form-item class="L-form-item" label="角色">
                              </el-form-item>
                              <el-form-item class="L-form-item" label="密码">
                              </el-form-item>
                        </el-form>
                    </div>
                </el-col>
                <!-- 个人信息 -->
                <el-col :span="10">
                    <div class="L-grid-content L-bg-purple">
                        <el-form :model="addForm">
                              <el-form-item class="L-form-item" prop="userName">
                                  <el-input :disabled="!name" v-model="addForm.userName" class="L-input">
                                      <el-button slot="append" class="L-input-button" @click.stop.native="changeName(addForm.sid)">
                                          <img src="../imgs/edit.png" alt="编辑">
                                      </el-button>
                                  </el-input>
                              </el-form-item>
                              <el-form-item class="L-form-item" prop="userPhone">
                                  <el-input :disabled="!name" v-model="addForm.userPhone" class="L-input">
                                      <el-button slot="append" class="L-input-button" @click.stop.native="changeuserPhone(addForm.userPhone)">
                                          <img src="../imgs/edit.png" alt="编辑">
                                      </el-button>
                                  </el-input>
                              </el-form-item>
                              <el-form-item class="L-form-item" prop="userId">
                                  <el-input :disabled="true" v-model="addForm.userId"></el-input>
                              </el-form-item>
                              <el-form-item class="L-form-item" prop="role">
                                  <el-input :disabled="true" v-model="addForm.role"></el-input>
                              </el-form-item>
                              <el-form-item class="L-form-item" prop="password">
                                  <el-input :disabled="true" v-model="addForm.password" class="L-input" type="password">
                                      <el-button slot="append"  class="L-input-button" @click.stop.native="changePassword">
                                          <img src="../imgs/edit.png" alt="编辑">
                                      </el-button>
                                  </el-input>
                               </el-form-item>
                        </el-form>
                    </div>
                </el-col>
            </el-row>
        </div>

        <!-- 修改密码页 -->
        <el-dialog title="密码修改" v-model="passwordFormVisible" :close-on-click-modal="false" align="center" class="L-header">
            <el-form :model="editForm" label-width="80px" :rules="editFormRules" ref="editForm">
                <el-form-item label="原始密码" prop="oldPassword">
                    <el-input v-model="editForm.oldPassword" auto-complete="off"></el-input>
                </el-form-item>
                <el-form-item label="新  密  码">
                    <el-input v-model="editForm.newPassword" :span="24"></el-input>
                </el-form-item>
                <el-form-item label="确认密码">
                    <el-input v-model="editForm.confirmNewPassword" :span="24"></el-input>
                </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer" >
                <el-button class="L-edit-button L-save-password-button" type="primary" @click.native="editSubmit" :loading="editLoading">保存</el-button>
            </div>
        </el-dialog>
    </section>
</template>

<script>
import { api } from '../js/api/api';

export default {
    mounted(){
        this.getAdmin()
    },
    methods:{
        getAdmin: function(){
            this.$http.post( api.getUser).then((res) => {
                this.addForm = res.body.rtData.user;
                this.imageUrl = encodeURI(encodeURI(api.getAttach + "&attachPath=" + res.body.rtData.userPhotos[0].attachPath));
            })
        },
        changeName:function(item,id){
            this.$http.post( api.UserEditor, )
            this.name = !this.name;
        },
        changePassword:function(){
            this.passwordFormVisible = true;
            this.editForm = {
                oldPassword:'',
                newPassword:'',
                confirmNewPassword:''
            }
        },
        editSubmit:function(){

        },
        handleAvatarScucess(res, file) {
            this.imageUrl = URL.createObjectURL(file.raw);
        },
        beforeAvatarUpload(file) {
            const isJPG = file.type === 'image/jpeg';
            // const isLt2M = file.size / 1024 / 1024 < 2;
            //
            // if (!isJPG) {
            //     this.$message.error('上传头像图片只能是 JPG 格式!');
            // }
            // if (!isLt2M) {
            //     this.$message.error('上传头像图片大小不能超过 2MB!');
            // }
            // return isJPG && isLt2M;
        },
        handleRemove(file, fileList) {

        }
    },
    data() {
        return {
            addForm:{
                userName:"",
                userPhone:"",
                userId:"",
                role:"",
                password:"",
                sid:""
            },
            dialogVisible: false,
            passwordFormVisible:false,
            editLoading:false,
            editForm:{
                oldPassword:'',
                newPassword:'',
                confirmNewPassword:''
            },
            editFormRules: {
				name: [
					{ required: true, message: '请输入姓名', trigger: 'blur' }
				]
			},
            type:'',
            name:false,
            imageUrl: '',
            imgurl:api.UserPhone
        }
    }
}
</script>

<style lang="css">
    .L-grid-content {
        border-radius: 4px;
        min-height: 36px;
    }
    .L-width{
        width: 80%;
        min-width: 1000px;
        margin:10% auto 0;
    }
    .L-background{
        width: 100%;
        height: 100%;
        background: #F2F2F2;
        padding: 1px;
    }
    .L-width .el-row{
        margin:0 auto;
    }
    .L-grid-content img{
        display: block;
        margin: auto;
    }
    .L-form-item{
        margin:0 !important;
    }
    .L-form-item input{
        text-align: center;
    }
    .L-form-item .el-form-item__label{
        width: 100%;
        height: 3.5rem;
        border-bottom: 1px solid #E4E4E4;
        text-align: center;
    }
    .L-input{
        position: relative;
    }
    .L-form-item input{
        background: #fff !important;
        height: 3.5rem;
    }
    .L-input .el-input-group__append{
        position: absolute;
        right: 1px;
        height: 2rem;
        top: 45%;
        width: 2rem;
        border: none;
        /*transform: translate(-50%,-50%);*/
        padding: 0 !important;
        background: transparent;
    }
    .L-input-button{
        padding: 0 !important;
    }
    .L-input-button img{
        width: 2rem;
        height: 2rem;
    }
    .L-header .el-dialog__header{
        background: #4DA1E7;
        height: 3rem;
    }
    .L-header .el-dialog__title{
        color:#fff;
    }
    .L-header .dialog-footer{
        width: 100%;
    }
    .L-header .L-save-password-button{
        width: 20%;
        height:4rem;
        margin: auto;
        display: block !important;
    }
    .avatar-uploader .el-upload {
        border: 1px dashed #d9d9d9;
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .avatar-uploader .el-upload:hover {
       border-color: #20a0ff;
    }
    .L-bg-purple .avatar-uploader-icon {
        font-size: 28px;
        color: #8c939d;
        width: 190px;
        height: 190px;
        line-height: 178px;
        text-align: center;
    }
    .L-bg-purple .avatar {
        width: 190px;
        height: 190px;
        display: block;
    }
</style>
