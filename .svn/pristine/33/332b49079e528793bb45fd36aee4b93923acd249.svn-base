<template>
    <div class="yDingdanPad" style="padding:10px 20px 0 20px;">
        <div>
            <el-tabs v-model="selectTab" @tab-click="tabClick">
                <el-tab-pane name="first" label="">
                    <span slot="label">全部列表</span>
                </el-tab-pane>
                <el-tab-pane label="审核中">
                    <span slot="label">审核中<b>({{shenheNum}})</b></span>
                </el-tab-pane>
                <el-tab-pane  label="待发货">
                    <span slot="label">待发货<b>({{daiNum}})</b></span>
                </el-tab-pane>
                <el-tab-pane  label="已发货">
                    <span slot="label">已发货<b>({{yiNum}})</b></span>
                </el-tab-pane>
                <el-tab-pane  label="安装中">
                    <span slot="label">安装中<b>({{zhongNum}})</b></span>
                </el-tab-pane>
                <el-tab-pane  label="已完成">
                    <span slot="label">已完成<b>({{wanNum}})</b></span>
                </el-tab-pane>
            </el-tabs>
        </div>
        <div style="margin-bottom:10px;">
            <el-input placeholder="订单编号/产品名称/收货人" icon="search" class="yDingdansou" style="width:30%;" v-model="input"></el-input>
            <el-date-picker v-model="startTime" type="date" editable placeholder="选择日期"></el-date-picker>
            ——
            <el-date-picker v-model="endTime" type="date" editable placeholder="选择日期"></el-date-picker>
            <el-button type="primary" @click="sousou">搜索</el-button>
        </div>
        <div class="yDingDanBT">
            <div class="ychanPinN">
                <div>产品</div>
                <div>数量</div>
            </div>
            <div>总计数量</div>
            <div>收货人</div>
            <div>状态</div>
            <div>操作</div>
        </div>
        <div v-for="(item,key) in tableData" class="yDingDanMain" style="margin-bottom10px;">
            <div class="yDingDanTimeAndBH">
                <div>
                    <el-checkbox @change="getSid(item.sid)"></el-checkbox>
                </div>
                <div>时间：{{item.createTime}}</div>
                <div @click="info(item.sid,item.orderStatus)">订单编号：{{item.orderNumber}}</div>
            </div>
            <div class="yDingDanInfo">
                <div>
                    <div v-for="name in item.orderItemList" class="ychanPinN">
                        <div>{{name.productName}}</div>
                        <div>{{name.productNums}}</div>
                    </div>
                </div>
                <div class="yCenter">
                    <div>{{item.equipmentNums}}</div>
                </div>
                <div class="yCenter">
                    <div>{{item.receiveUserName}}</div>
                </div>
                <div class="yCenter">
                    <div>{{item.orderStatus}}</div>
                </div>
                <div >
                        <div v-if="item.orderStatus==state1" class="yMidd">
                            <div>
                                <el-button @click="shenhedingdan(item.sid,1,item.orderStatus)">修改订单信息</el-button>
                            </div>
                            <div>
                                <el-button @click="shenhedingdan(item.sid,2,item.orderStatus)">修改收货信息</el-button>
                            </div>
                        </div>
                        <!-- <div v-if="item.orderStatus==state2" class="yMidd">
                            <div>
                                <el-button @click="shenhedingdan(item.sid,2,item.orderStatus)">修改收货信息</el-button>
                            </div>
                            <div>
                                <el-button @click="shenhedingdan(item.sid,3,item.orderStatus)">修改设备信息</el-button>
                            </div>
                        </div> -->
                        <!-- <div v-if="item.orderStatus==state1" class="yMidd">
                            <div>
                                <el-button @click="shenhedingdan(item.sid,3,item.orderStatus)">修改设备信息</el-button>
                            </div>
                            <div>
                                <el-button @click="shenhedingdan(item.sid,4,item.orderStatus)">修改施工信息</el-button>
                            </div>
                        </div> -->
                        <div v-else>

                        </div>
                </div>
            </div>
        </div>
        <!-- 分页 -->
        <el-pagination
        style="text-align:right;"
         :current-page="currentPage"
         layout="total,prev, pager, next"
         :total="total"
         :page-size="pageSize"
         @current-change="currentChange">
       </el-pagination>
    </div>
</template>
<script>
    import {api} from '../../js/api/api.js'
    import {getCheckdate,trasSecond} from '../../js/api/getNowDate.js'
    export default {
        data() {
            return {
                shenheNum:"",
                daiNum:"",
                yiNum:"",
                zhongNum:"",
                wanNum:"",
                input:"",
                state1:"审核中",
                state2:"待发货",
                state3:"已发货",
                startTime:"",
                endTime:"",
                selectTab:"first",
                selectTabInfoNum:"3",
                value6:"",
                sids:[],
                tableData: [],
                currentPage:1,
                total:6,
                pageSize:10
            }
        },
        mounted () {
            this.getList();
            this.getNum();
        },
        methods:{
            getList () {
                let params={
                    "rows":this.pageSize,
                	"page":this.currentPage,
                	"sort":"sid",
                	"order":"desc"
                }
                this.$http.post(api.getCustomerOrderDatagrid,params).then((response)=>{
                    // console.log(response.body)
                    this.total=response.body.total
                    this.tableData=response.body.rows
                    for(var i=0;i<this.tableData.length;i++){
                        this.tableData[i].createTime=trasSecond(this.tableData[i].createTime)
                    }
                })
            },
            getNum () {
                this.$http.post(api.getCustomerOrderCount+"&orderStatus=审核中").then((response)=>{
                    // console.log(response)
                    this.shenheNum=response.body.rtData
                })
                this.$http.post(api.getCustomerOrderCount+"&orderStatus=待发货").then((response)=>{
                    // console.log(response)
                    this.daiNum=response.body.rtData
                })
                this.$http.post(api.getCustomerOrderCount+"&orderStatus=已发货").then((response)=>{
                    // console.log(response)
                    this.yiNum=response.body.rtData
                })
                this.$http.post(api.getCustomerOrderCount+"&orderStatus=安装中").then((response)=>{
                    // console.log(response)
                    this.zhongNum=response.body.rtData
                })
                this.$http.post(api.getCustomerOrderCount+"&orderStatus=已完成").then((response)=>{
                    // console.log(response)
                    this.wanNum=response.body.rtData
                })
            },
            sousou () {
                let params={
                    "rows":this.pageSize,
                	"page":this.currentPage,
                	"sort":"sid",
                	"order":"desc",
                    "startTime":getCheckdate(this.startTime),
                    "endTime":getCheckdate(this.endTime),
                    "queryStr":this.input
                }
                this.$http.post(api.getCustomerOrderDatagrid,params).then((response)=>{
                    // console.log(response.body)
                    this.total=response.body.total
                    this.tableData=response.body.rows
                    for(var i=0;i<this.tableData.length;i++){
                        this.tableData[i].createTime=trasSecond(this.tableData[i].createTime)
                    }
                })
            },
            currentChange (val) {
                this.currentPage=val;
                this.getList();
            },
            getSid (row,key) {
                // console.log(event.target.checked);
                if(event.target.checked){
                    this.sids.push(row);
                }else{
                    this.sids.splice(this.sids.indexOf(row),1);
                }

            },
            tabClick (tab) {
                // console.log(tab);
                let params={
                    "rows":this.pageSize,
                	"page":this.currentPage,
                	"sort":"sid",
                	"order":"desc",
                    "orderStatus":tab.label
                }
                this.$http.post(api.getCustomerOrderDatagrid,params).then((response)=>{
                    // console.log(response.body);
                    this.total=response.body.total
                    this.tableData=response.body.rows
                    for(var i=0;i<this.tableData.length;i++){
                        this.tableData[i].createTime=trasSecond(this.tableData[i].createTime)
                    }
                })
            },
            info (sid,state) {
                console.log(sid)
                this.$router.push({
                    name:"dingdaninfo",
                    params:{
                        id:sid,
                        states:state
                    }
                })
            },
            shenhedingdan (sid,buttonId,state){
                this.$router.push({
                    name:"editdingdaninfo",
                    params:{
                        id:sid,
                        button:buttonId,
                        states:state
                    }
                })
            }
        }
    }
</script>
<style>
    .yDingDanMain{
        margin-bottom: 2px;
    }
    .yDingDanBT,.yDingDanTimeAndBH,.yDingDanInfo,.ychanPinN{
        display: -webkit-box;
    }
    .yDingDanBT{
        background-color: #eef1f6;
        text-align: center;
        margin-bottom: 2px;
    }
    .yDingDanBT>div,.yDingDanInfo>div{
        width:0%;
        -webkit-box-flex:1;
        border-bottom: 1px solid #000;
        line-height: 40px;
    }
    .yDingDanInfo>div:first-child,.yDingDanBT>div:first-child{
        -webkit-box-flex:2;
    }
    .yDingDanInfo{
        text-align: center;
    }
    .yDingDanTimeAndBH{
        background-color:#c4e4f4;
        line-height: 40px;
    }
    .yDingDanTimeAndBH>div{
        margin-left: 10px;
    }
    .ychanPinN>div{
        width: 0%;
        -webkit-box-flex:1;
    }
    .ychanPinN>div:first-child{
        -webkit-box-flex:3;
    }
    .yCenter{
        display: -webkit-box;
        -webkit-box-align:center;
        -webkit-box-pack:center;
    }
    .yMidd{
        display: -webkit-box;
        -webkit-box-orient:vertical;
        -webkit-box-align:center;
    }
    .yDingdansou{
        width: 30% !important;
    }
</style>
